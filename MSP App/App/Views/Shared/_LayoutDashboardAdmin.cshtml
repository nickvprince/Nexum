<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Nexum</title>
    <link rel="stylesheet" href="~/lib/bootstrap/css/bootstrap.min.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/lib/bootstrap-icons/font/bootstrap-icons.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
</head>
<body class="">
    <div id="svg-sprite" style="display:none">
        @inject Microsoft.AspNetCore.Hosting.IWebHostEnvironment WebHostEnvironment
        @Html.Raw(System.IO.File.ReadAllText(System.IO.Path.Combine(WebHostEnvironment.WebRootPath, "lib", "bootstrap-icons", "bootstrap-icons.svg")))
    </div>
    <header class="bg-nexum-dark bg-gradient sticky-top">
        <partial name="_NavBarPartial" />
    </header>
    <nav id="sideNav" class="vertical-nav d-flex flex-column align-items-center justify-content-between p-2 border border-3 border-start-0 rounded-end-5 overflow-y-auto">
        <partial name="_DashboardSideNavAdminPartial" />
    </nav>
    <main role="main" style="margin-left: 220px; margin-right: 10px;">
        <partial name="_TempDataMessagePartial" />
        @RenderBody()
    </main>
    <partial name="_FooterPartial" />
    <script src="~/lib/jquery/dist/jquery.min.js" asp-append-version="true"></script>
    <script src="~/lib/bootstrap/js/bootstrap.bundle.min.js" asp-append-version="true"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @* <script src="_framework/blazor.server.js"></script> *@
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        function updateSideNavClasses() {
            var sideNavs = document.querySelectorAll('#sideNav');
            sideNavs.forEach(function (sideNav) {
                if (window.innerWidth < 1400) { // breakpoint for Bootstrap
                    sideNav.classList.remove('vertical-nav', 'flex-column', 'border-start-0', 'rounded-end-5', 'overflow-y-auto');
                    sideNav.classList.add('horizontal-nav', 'rounded-top-0', 'rounded-5', 'border-top-0', 'overflow-y-hidden');
                    sideNav.style.width = '100%';
                    var svgs = Array.from(sideNav.getElementsByTagName('svg'));
                    svgs.forEach(function (svg) {
                        svg.style.maxHeight = '55px';
                    });
                } else {
                    sideNav.classList.remove('horizontal-nav', 'rounded-top-0', 'rounded-5', 'border-top-0', 'overflow-y-hidden');
                    sideNav.classList.add('vertical-nav', 'flex-column', 'border-start-0', 'rounded-end-5', 'overflow-y-auto');
                    sideNav.style.width = '210px';
                    var svgs = Array.from(sideNav.getElementsByTagName('svg'));
                    svgs.forEach(function (svg) {
                        svg.style.maxHeight = null;
                    });
                }
            });
            var mainElement = document.querySelector('main[role="main"]');
            if (window.innerWidth < 1400) {
                mainElement.style.marginLeft = '10px';
                mainElement.style.marginTop = '115px';
            } else {
                mainElement.style.marginLeft = '220px';
                mainElement.style.marginTop = '0px';
            }
        }

        // Run the function on load
        updateSideNavClasses();

        // Add event listener for window resize
        window.addEventListener('resize', updateSideNavClasses);
    });
</script>
<script>
    document.getElementById('navDropdownMenuButton').addEventListener('click', function () {
        var dropdownMenu = document.getElementById('navDropdownMenu');
        dropdownMenu.style.display = dropdownMenu.style.display === 'block' ? 'none' : 'block';
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        function setActiveLink(linkId) {
            var sideNavs = document.querySelectorAll('#sideNav');
            sideNavs.forEach(function (sideNav) {
                var navLinks = sideNav.querySelectorAll('.nav-link');
                navLinks.forEach(function (link) {
                    link.classList.remove('active');
                });
            });
            var activeLinks = document.querySelectorAll(`#${linkId}`);
            activeLinks.forEach(function (activeLink) {
                activeLink.classList.add('active');
            });
        }

        // Get the active link from session storage
        var activeLinkId = '@Context.Session.GetString("ActiveNavLink")';
        if (activeLinkId) {
            console.log('Active link from session:', activeLinkId);
            setActiveLink(activeLinkId);
        } else {
            console.log('No active link found in session storage.');
        }

        // Add click event listeners to each nav link
        var sideNavs = document.querySelectorAll('#sideNav');
        sideNavs.forEach(function (sideNav) {
            var navLinks = sideNav.querySelectorAll('.nav-link');
            navLinks.forEach(function (link) {
                link.addEventListener('click', function () {
                    event.preventDefault();
                    var linkId = this.id;
                    var targetUrl = this.getAttribute('href');

                    console.log('Clicked link id:', linkId);
                    setActiveLink(linkId);
                    console.log(JSON.stringify({ activeLinkId: linkId }));
                    // Save the active link to session storage via Ajax request
                    $.ajax({
                        type: 'POST',
                        url: '/api/Session',
                        contentType: 'application/json',
                        data: JSON.stringify({ activeLinkId: linkId }),
                        success: function () {
                            console.log('Active link saved to session storage:', linkId);
                            window.location.href = targetUrl;
                        },
                        error: function (xhr, status, error) {
                            console.error('Failed to save active link to session storage:', error);
                        }
                    });
                });
            });
        });
        var homeLogo = document.getElementById('nexumLogoLink');
        homeLogo.addEventListener('click', function () {
            event.preventDefault();
            var homeLogoId = this.id;
            var targetUrl = this.getAttribute('href');
            console.log('Clicked logo id:', homeLogoId);
            $.ajax({
                type: 'POST',
                url: '/api/Session',
                contentType: 'application/json',
                data: JSON.stringify({ activeLinkId: 'homeLink' }),
                success: function () {
                    console.log('Active link saved to session storage:', 'homeLink');
                    window.location.href = targetUrl;
                },
                error: function (xhr, status, error) {
                    console.error('Failed to save active link to session storage:', error);
                }
            });
        });
        var adminPanelLink = document.getElementById('adminLink');
        adminPanelLink.addEventListener('click', function () {
            event.preventDefault();
            var adminPanelLinkId = this.id;
            var targetUrl = this.getAttribute('href');
            console.log('Clicked logo id:', adminPanelLinkId);
            $.ajax({
                type: 'POST',
                url: '/api/Session',
                contentType: 'application/json',
                data: JSON.stringify({ activeLinkId: 'tenantLink' }),
                success: function () {
                    console.log('Active link saved to session storage:', 'tenantLink');
                    window.location.href = targetUrl;
                },
                error: function (xhr, status, error) {
                    console.error('Failed to save active link to session storage:', error);
                }
            });
        });
    });
</script>